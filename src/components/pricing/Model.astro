---
interface Props {
  id: string;
  quantization: string;
  context_length: string;
  max_completion_tokens: string;
  promptPricing: string;
  completionPricing: string;
  speed: number;
}

const {
  id,
  quantization,
  context_length,
  max_completion_tokens,
  promptPricing,
  completionPricing,
  speed,
} = Astro.props;

// Parse numbers from strings that might have commas
const parseNumber = (str: string | number): number => {
  if (typeof str === "number") return str;
  return parseInt(str.replace(/,/g, ""));
};

const contextNum = parseNumber(context_length);
const maxOutputNum = parseNumber(max_completion_tokens);

// Speed color calculation
const minSpeed = 10;
const maxSpeed = 1000;
const calibrate = (n: number, min: number, max: number): number => {
  return (n - min) / (max - min);
};

const speedPercent = Math.min(
  calibrate(Math.log(speed), Math.log(minSpeed), Math.log(maxSpeed)) * 100,
  100,
);
const speedColor = `color-mix(in oklab, oklch(0.8 0.3379 164.12) ${speedPercent}%, oklch(0.8 0.0664 0))`;
---

<tr>
  <td>
    <h2 class="font-title-medium">
      {id}
      <button
        class="copy-button"
        onclick={`navigator.clipboard.writeText('${id}')`}
        title="Copy model ID"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M9 18q-.825 0-1.412-.587T7 16V4q0-.825.588-1.412T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.587 1.413T18 18zm0-2h9V4H9zm-4 6q-.825 0-1.412-.587T3 20V7q0-.425.288-.712T4 6t.713.288T5 7v13h10q.425 0 .713.288T16 21t-.288.713T15 22zm4-6V4z"
          ></path>
        </svg>
      </button>
    </h2>
    <div class="chips">
      <div class="chip font-label-medium">{quantization}</div>
      <div class="chip font-label-medium">
        {
          maxOutputNum != contextNum
            ? `${Math.floor(contextNum / 1024)}k context / ${Math.floor(maxOutputNum / 1024)}k output`
            : `${Math.floor(contextNum / 1024)}k`
        }
      </div>
    </div>
  </td>
  <td style="text-align: right">${promptPricing}</td>
  <td style="text-align: right">${completionPricing}</td>
  <td style={`text-align: right${speedColor ? `; color: ${speedColor}` : ""}`}>
    {speed} tps
  </td>
</tr>

<style>
  td {
    padding-block: 0.5rem;
    border-bottom: 1px solid rgb(var(--m3-scheme-outline-variant));
    /*&:first-child {
      padding-left: 1rem;
    }
    &:last-child {
      padding-right: 1rem;
    }*/
  }

  h2 {
    display: inline-flex;
    align-items: center;
    gap: 0.5em;
    margin: 0;
  }

  .copy-button {
    cursor: pointer;
  }

  .chips {
    display: flex;
    gap: 0.25rem;
    margin-top: 0.25rem;
  }

  .chip {
    display: flex;
    height: 2rem;
    align-items: center;
    padding-inline: 0.5rem;
    border-radius: 9999px;
    background-color: rgb(var(--m3-scheme-primary-container-subtle));
    color: rgb(var(--m3-scheme-on-primary-container-subtle));
  }
</style>
